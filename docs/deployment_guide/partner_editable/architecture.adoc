:xrefstyle: short

Deploying this Quick Start for a new virtual private cloud (VPC) with
default parameters builds the following {partner-product-short-name} environment in the
AWS Cloud.

// Replace this example diagram with your own. Follow our wiki guidelines: https://w.amazon.com/bin/view/AWS_Quick_Starts/Process_for_PSAs/#HPrepareyourarchitecturediagram. Upload your source PowerPoint file to the GitHub {deployment name}/docs/images/ directory in this repo. 

[#architecture1]
.Quick Start architecture for {partner-product-short-name} on AWS
image::../docs/deployment_guide/images/architecture_diagram.png[Architecture]

As shown in <<architecture1>>, the Quick Start sets up the following:

* A highly available architecture that spans three Availability Zones.*
* A VPC configured with public and private subnets according to AWS best practices, to provide you with your own virtual network on AWS.*
* In the public subnets:
** Managed network address translation (NAT) gateways to allow outbound internet access for resources in the private subnets.*
** A Linux bastion host in an Auto Scaling group to allow inbound Secure Shell (SSH) access to EC2 instances in public and private subnets.*
** A Network Load Balancer attached to the public subnets. The load balancer listens on port 443 and directs traffic to the NGINX pod configured as a Kubernetes object. The NGINX container provides ingress, reverse proxy, and Secure Sockets Layer (SSL) termination for the Artifactory primary and secondary pods.
* In the private subnets:
** In the first Availability Zone, a primary Amazon EKS node with NGINX and Artifactory pods in an Auto Scaling group.
** In the second and third Availability Zones, a secondary Amazon EKS node with NGINX, Artifactory, and Xray pods, in an Auto Scaling group.
** An Amazon Relational Database Service (Amazon RDS) DB instance connected via the private subnets of the VPC and accessible only from those subnets on port 3306.
* A private and encrypted Amazon Simple Storage Service (Amazon S3) bucket for repository storage.
* Amazon EKS for the cluster to run NGINX, Artifactory, and Xray containerized applications.

*The template that deploys the Quick Start into an existing VPC skips
the components marked by asterisks and prompts you for your existing VPC
configuration.

=== Amazon EKS services

There are two Auto Scaling groups for the Artifactory EKS hosts that make up the primary
and secondary https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#partitions[partitions^]. The pods are configured to be deployed in their respective
partitions. Upon an Artifactory service or overall pod failure, Kubernetes handles
rescheduling and redeploying the failed pod to a node. As a result, all configurations are
done on boot to each container and results in a loss of data that is not stored in the Amazon
RDS instance or the S3 bucket.

WARNING: Do not change the stackâ€™s master key when you update the stack. This
will result in future nodes being unable to join the cluster and an unsupported
configuration. +
 +
To update a Secure Sockets Layer (SSL) certificate, you will need to update the
CloudFormation stack by changing the certificate and certificate key inputs, and redeploying the nodes (see <<_updating_artifactory, Updating Artifactory>>). If you change the certificate and
certificate key manually on the EC2 instances, instead of updating the
CloudFormation stack, the manual changes will be lost during the next upgrade or
reboot, resulting in an unwanted configuration.
